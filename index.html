<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="mobile-web-app-capable" content="yes">

		<title>Analog Stopwatch</title>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.3.1/p5.min.js"></script>
		<style>
html, css{
  touch-action:none;
}


body {
	user-select: none;
}

canvas {
	display: block;
	margin: 0 auto;
}
#resetBtn,#addBtn {
	background-color: #fff;
	border: 2px solid #007aff;
	color: #007aff;
	border-radius: 4px;
	cursor: pointer;
	font-weight: bold;
	font-size: 20px;
}
#resetBtn:hover,#addBtn:hover {
	background-color: #007aff;
	color: #fff;
}
#clearBtn {
	background-color: #f42943;
	color: #fff;
	border: none;
	border-radius: 4px;
	cursor: pointer;
	font-weight: bold;
	font-size: 20px;
}


		</style>

	</head>

	<body>
		<script>
			let cx, cy, r, angle = 0,
				running = false,
				count = 0,
				second = 0;
			isAdded = false;
			let times = [];
			let sum =0;

			function setup() {
				//createCanvas(windowWidth, windowHeight);
		        createCanvas(windowWidth*.7, windowHeight*.7);

				cx = width / 2;
				cy = height / 2;
				r = min(width, height) * 0.42;
				frameRate(60);
				// create reset button
				let resetButton = createButton('Reset');
				resetButton.id('resetBtn');
				resetButton.class('Btn');

				resetButton.position(cx+width/7, 0.95 * height);
				resetButton.mousePressed(reset);
				// create add time button
				let addButton = createButton('M+');
				addButton.id('addBtn');
				addButton.class('Btn');
				addButton.position(cx +width/7 + addButton.width/2.5, cy+80);
				addButton.mousePressed(addTime);
				let cButton = createButton('M-');
				cButton.id('clearBtn');
				cButton.class('Btn');      
				cButton.position(width*.5, 5 + cButton.height);
				cButton.mousePressed(removeTime);
				let clearButton = createButton('MC');
				clearButton.id('clearBtn');
				clearButton.class('Btn');
				clearButton.position(width*.9, 5 + clearButton.height);
				clearButton.mousePressed(clearTime);
			}

			function draw() {
				background(255);
				drawWatch();
				if (running) {
					angle += TWO_PI / 360;
					count = round(map(angle, 0, TWO_PI, 0, 144, true));
					if (count % 24 !== 0 && isAdded)
						isAdded = false;
					if (count % 24 == 0 && count > 0 && !isAdded) {
						second++;
						count = 0;
						isAdded = true;
					}
					if (count == 144) {
						count = 0;
						angle = 0;
					}
				}
				push(), translate(cx, cy), rotate(angle - HALF_PI), stroke(255, 0, 0), strokeWeight(4), line(0, 0, r * 0.95, 0), pop();
				textAlign(CENTER, CENTER);
				textSize(50);
				fill(0);
				let paddedMinute = (floor(second / 60)).toString().padStart(2, '0')
				let paddedSecond = (second % 60).toString().padStart(2, '0');
				let paddedCount = (count % 24).toString().padStart(2, '0');
				textFont("Courier New");
				text(paddedMinute + ":" + paddedSecond + "\n+" + paddedCount, cx, cy);
				drawTimes();
			}

			function drawTimes() {
				// display times
				textAlign(CENTER, CENTER);
				fill(100);
				noStroke();
				textSize(35);
				let margin = 35;
				for (let i = 0; i < times.length; i++) {

					text(times[i], width * .15, 30 + i * margin);
				}
				stroke(0);
				line(width * .02, margin/2 + (times.length) * margin, width * .28,margin/2 + (times.length) * margin);
				let paddedMinute = ( floor(sum/(24*60))).toString().padStart(2, '0');
				let paddedSecond = (floor(sum/24)).toString().padStart(2, '0');
				let paddedCount = (sum%24).toString().padStart(2, '0');
				let timeString = paddedMinute + ":" + paddedSecond + "+" + paddedCount;
				fill(0);
				noStroke();
				text(timeString, width * .15, margin + (times.length) * margin);
			}

			function drawWatch() {
				push(), translate(cx, cy), noFill();
				for (let i = 0; i < 144; i++) {
					let tickLength = 10,
						weight = 2,
						color = 200;
					if (i % 24 === 0) tickLength = 30, weight = 4, color = 0;
					else if (i % 6 === 0) tickLength = 30, color = 100;
					else if (i % 3 === 0) tickLength = 20, color = 100;
					strokeWeight(weight), stroke(color);
					let tickAngle = map(i, 0, 144, 0, TWO_PI) - HALF_PI;
					line(cos(tickAngle) * (r - tickLength), sin(tickAngle) * (r - tickLength), cos(tickAngle) * r, sin(tickAngle) * r);
				}
				for (let i = 0; i < 24; i++) {
					push();
					let angle = map(i, 0, 24, 0, TWO_PI) - HALF_PI;
					translate(r * 0.8 * cos(angle), r * 0.8 * sin(angle));
					textAlign(CENTER, CENTER), textSize(15), fill(100);
					if (i % 4 * 6 == 12) textSize(20), fill(50);
					text(i % 4 == 0 ? "" : i % 4 * 6, 0, 0);
					pop();
				}
				for (let i = 0; i < 6; i++) {
					push();
					let angle = map(i, 0, 6, 0, TWO_PI) - HALF_PI;
					translate(r * 0.8 * cos(angle), r * 0.8 * sin(angle));
					textAlign(CENTER, CENTER), textSize(30), fill(0), textStyle(BOLD);
					text(i == 0 ? 6 : i, 0, 0);
					pop();
				}
				stroke(0), strokeWeight(4);
				ellipse(0, 0, r * 2);
				strokeWeight(2), stroke(200);
				ellipse(0, 0, r * 2 - 20);
				strokeWeight(2), stroke(100);
				ellipse(0, 0, r * 2 - 40);
				pop();
			}

			function reset() {
				angle = 0;
				running = false;
				count = 0;
				second = 0;
			}


			function mousePressed(e) {
				if (e.target.className !== "Btn" ) {
					running = !running;
				}
				if (!running) {
					angle = round(angle / (TWO_PI / 144)) * (TWO_PI / 144);
				}
			}



			function touchStarted() {
				for (let i = 0; i < touches.length; i++) {
					let touch = touches[i];
					if (touch.target.className !== "Btn") {
						running = !running;
					}
					if (!running) {
						angle = round(angle / (TWO_PI / 144)) * (TWO_PI / 144);
					}
				}
			}


			function addTime() {
				sum += second*24+count%24;
				let paddedMinute = (floor(second / 60)).toString().padStart(2, '0');
				let paddedSecond = (second % 60).toString().padStart(2, '0');
				let paddedCount = (count % 24).toString().padStart(2, '0');
				let timeString = paddedMinute + ":" + paddedSecond + "+" + paddedCount;
				times.push(timeString);
			}
			function removeTime(){
				var m =parseInt(times[times.length-1].split(":")[0])*60*24;
				var s =parseInt(times[times.length-1].split(":")[1])*24;
				var f =parseInt(times[times.length-1].split("+")[1]);
				sum-=(m+s+f);      
				times.pop();
			}
			function clearTime(){
				sum=0;
				times=[];
			}

		</script>
	</body>

</html>
